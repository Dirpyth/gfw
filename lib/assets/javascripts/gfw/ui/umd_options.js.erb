gfw.ui.model.UmdOptions = cdb.core.Model.extend({  
  defaults: {
    tooltip: "Options"
  }
});

gfw.ui.view.UmdOptions = cdb.core.View.extend({
  className: 'umdoptions',

  events: {
    'click #umd_options-control' : '_openUMDoptions'
  },

  initialize: function() {
    _.bindAll( this, '_toggle' );

    this.model = new gfw.ui.model.UmdOptions();

    this.model.on('change:hidden', this._toggle);
  
    var template = $('#umd_options-template').html();

    this.template = new cdb.core.Template({
      template: template,
      type: 'mustache'
    });

    this._initViews();
  },

  _initViews: function() {
    this.umdoptions_dialog = new gfw.ui.view.umdoptionsDialog({});

    $('#map').append(this.umdoptions_dialog.render());
  },

  _openUMDoptions: function(e) {
    e.preventDefault();

    this.umdoptions_dialog.show();
  },

  _toggle: function() {
    if (this.model.get('hidden')) {
      this.$el.hide();
    } else {
      this.$el.show();
    }
  },

  show: function() {
    this.model.set('hidden', false);
    $('.share_control').addClass('umd_options')
  },

  hide: function() {
    this.model.set('hidden', true);
    $('.share_control').removeClass('umd_options')
  },

  render: function() {
    this.$el.append(this.template.render( this.model.toJSON() ));
    this.$umd_options_control = (this.$el.find('.umd_options-control').length > 0) ? this.$el.find('.umd_options-control') : null;
    if (!!this.$umd_options_control) {
      $(this.$umd_options_control).tipsy({ title: 'data-tip', fade: true, gravity: 'w' });
    }

    return this.$el;
  }
});


gfw.ui.model.umdoptionsDialog = Backbone.Model.extend({
  defaults: {
    title: "Options"
  }

});

gfw.ui.view.umdoptionsDialog = gfw.ui.view.Widget.extend({
  className: 'umdoptions_dialog',

  events: {
    'click .close': 'hide'
  },

  initialize: function() {

    this.options = _.extend(this.options, this.defaults);

    this.model = new gfw.ui.model.umdoptionsDialog();

    this.model.on('change:hidden', this.toggle);
    this.model.on('change:mode', this._toggleMode);

    var template = $('#umdoptions_dialog-template').html();

    this.template = new cdb.core.Template({
      template: template,
      type: 'mustache'
    });
  },

  show: function() {
    this.$el.fadeIn(250);
  },

  hide: function(e) {
    e && e.preventDefault();

    var that = this;

    this.$el.fadeOut(250);
  },

  _onEscKey: function(e) {
    e && e.preventDefault();

    this.hide();
  },

  render: function() {
    this.$el.append(this.template.render( this.model.toJSON() ));

    return this.$el;
  }
});
